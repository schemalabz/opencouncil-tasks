/**
 * Prompt templates and system prompts for the summarize task.
 * Extracted from summarize.ts for better organization and maintainability.
 */

import { IMPORTANCE_GUIDELINES } from "../../lib/importanceGuidelines.js";

/**
 * Markdown reference format instructions (used in multiple prompts)
 */
export const MARKDOWN_REFERENCE_FORMAT_INSTRUCTIONS = `
**ΜΟΡΦΗ ΚΕΙΜΕΝΟΥ - MARKDOWN ΜΕ REFERENCES**

Το κείμενο πρέπει να είναι σε Markdown που υποστηρίζει:

**Μορφοποίηση:**
- **Bold text** με **αστερίσκους**
- *Italic text* με *έναν αστερίσκο*
- <u>Underline text</u> με HTML tag
- Ordered lists: 1. 2. 3.
- Unordered lists: - item

**Reference Links (ΠΟΛΥ ΣΗΜΑΝΤΙΚΟ):**
Χρησιμοποίησε ειδικά markdown links με το πρωτόκολλο REF:

Τύποι references:
- [κείμενο που αναφέρεται](REF:UTTERANCE:utteranceId) - σύνδεσμος σε συγκεκριμένο utterance
- [όνομα συμβούλου](REF:PERSON:personId) - σύνδεσμος σε άτομο
- [όνομα παράταξης](REF:PARTY:partyId) - σύνδεσμος σε παράταξη

**Πότε να βάζεις REF:UTTERANCE:**
✓ Άμεσα αποσπάσματα ή παραφράσεις
✓ Συγκεκριμένα επιχειρήματα
✓ Αριθμητικά στοιχεία
✓ Αμφιλεγόμενες ή σημαντικές δηλώσεις
✓ Συγκεκριμένες προτάσεις δράσης

✗ ΜΗΝ βάζεις reference σε:
- Γενικές παρατηρήσεις χωρίς συγκεκριμένη πηγή
- Το γενικό πλαίσιο που παρέχεις εσύ

**Σύνταξη reference:**
Παράδειγμα: Υποστηρίζει ότι [η καθαριότητα έχει υποβαθμιστεί](REF:UTTERANCE:utt-001)
και προτείνει [πρόσληψη 15 εργαζομένων](REF:UTTERANCE:utt-002).

Το κείμενο μέσα στα [ ] πρέπει να είναι περιεκτικό και να δείχνει τι λέει το utterance/πηγή.

**Σημαντικό:**
- Το utteranceId στα REF:UTTERANCE: πρέπει να είναι ΑΚΡΙΒΩΣ το utteranceId από το input
- Μπορείς να χρησιμοποιήσεις REF:PERSON: και REF:PARTY: όταν αναφέρεσαι σε άτομα/παρατάξεις
`;

/**
 * System prompt for batch processing of transcripts.
 * Generates segment summaries, discussion ranges, and subject extraction.
 */
export function getBatchProcessingSystemPrompt(metadata: {
  cityName: string;
  date: string;
  topicLabels: string[];
  administrativeBodyName?: string;
  additionalInstructions?: string;
}): string {
  const bodyInfo = metadata.administrativeBodyName
    ? `\nΌργανο: ${metadata.administrativeBodyName}`
    : '';

  if (!metadata.administrativeBodyName) {
    console.warn('⚠️  WARNING: administrativeBodyName not provided in batch processing prompt. Using generic description.');
  }

  return `
ΣΤΟΧΟΣ: Μετατρέπεις συνεδριάσεις δημοτικών οργάνων σε δομημένα δεδομένα που επιτρέπουν
στους πολίτες να κατανοήσουν τι συζητήθηκε, ποιος μίλησε, και τι αποφασίστηκε. Βλέπεις ένα batch (κομμάτι) της συζήτησης κάθε φορά.

Πόλη: ${metadata.cityName}${bodyInfo}
Ημερομηνία: ${metadata.date}

ΕΞΟΔΟΣ JSON (3 πεδία):
1. segmentSummaries - Περίληψη κάθε τοποθέτησης (1-3 προτάσεις)
2. subjects - Λίστα θεμάτων (ημερήσια διάταξη + εκτός / προ ημερησίας διάταξης)
3. ranges - Διαχωρισμός της συζήτησης σε τμήματα από συνεχόμενα utterances που αφορούν το ίδιο πράγμα (ATTENDANCE, SUBJECT_DISCUSSION, VOTE, OTHER)

═══════════════════════════════════════════════════════════════════════════
ΜΕΡΟΣ 1: SEGMENT SUMMARIES
═══════════════════════════════════════════════════════════════════════════

Κάθε segment έχει: id, summary (1-3 προτάσεις), type, labels

TYPE:
- SUBSTANTIAL: Γνώμες, επιχειρήματα, πληροφορίες, ερωτήματα ουσίας
  Παράδειγμα: "Η καθαριότητα έχει υποβαθμιστεί", "Προτείνω αύξηση κονδυλίων"
- PROCEDURAL: Διαδικαστικές παρεμβάσεις, λήψεις παρουσιών κ.α.
  Παράδειγμα: "Το λόγο έχει ο κ. Παπαδόπουλος", "Παρόντες 24 σύμβουλοι"

SUMMARY:
- ΑΠΛΟ ΚΕΙΜΕΝΟ - ΟΧΙ markdown, ΟΧΙ references [REF:...], ΟΧΙ links
- Όχι όνομα στην αρχή ("Ο Παπαδόπουλος λέει...")
- Γ' ενικό για ρήματα ("υποστηρίζει", "ανησυχεί")
- Κύρια σημεία, όχι λεπτομέρειες

LABELS:
Διάλεξε 0-3 από: ${metadata.topicLabels.join(", ")}
Μόνο αν το segment αναφέρεται στο θέμα.

═══════════════════════════════════════════════════════════════════════════
ΜΕΡΟΣ 2: SUBJECTS (ΘΕΜΑΤΑ)
═══════════════════════════════════════════════════════════════════════════

Τα subjects είναι τα επιμέρους θέματα που συζητούνται στη συνεδρίαση.

ΑΠΟΦΥΓΗ ΔΙΠΛΟΤΥΠΩΝ - ΚΡΙΣΙΜΟ:
- Τα παρόμοια θέματα ανήκουν στο ίδιο subject
- Θέμα Α + Θέμα Α' = ΕΝΑ subject (ενημέρωσε name/description)
- Αν αμφιβάλλεις, συγχώνευσε - μην δημιουργείς νέο

Διατήρηση υπαρχόντων subjects:
- Αν ενημερώνεις υπάρχον subject (ίδιο id): διατήρησε type, agendaItemIndex, introducedByPersonId
- Ενημέρωσε μόνο name και description αν χρειάζεται ώστε να παραμένουν περιγραφικά

ΔΟΜΗ ΣΥΝΕΔΡΙΑΣΗΣ ΔΗΜΟΤΙΚΟΥ ΣΥΜΒΟΥΛΙΟΥ:

Τυπική σειρά θεμάτων σε συνεδριάσεις:
1. Προ ημερησίας διάταξης (BEFORE_AGENDA) - Ανακοινώσεις, ερωτήματα χωρίς ψηφοφορία
2. Εκτός ημερησίας διάταξης (OUT_OF_AGENDA) - Επείγοντα θέματα προς ψήφιση που δεν ήταν στην αρχική διάταξη
3. Θέματα της ημερησίας διάταξης (IN_AGENDA) - Με τη σειρά, αν και μερικές φορές κάποια προτάσσονται ή αναβάλλονται

ΚΡΙΣΙΜΟ - ΔΗΜΙΟΥΡΓΙΑ ΝΕΩΝ SUBJECTS:
- Αν βλέπεις συζήτηση ΠΡΟ της ημερησίας διάταξης (ανακοινώσεις, ερωτήματα), ΔΗΜΙΟΥΡΓΗΣΕ νέο subject με type: BEFORE_AGENDA
- Αν βλέπεις επείγον θέμα ΕΚΤΟΣ της ημερησίας διάταξης, ΔΗΜΙΟΥΡΓΗΣΕ νέο subject με type: OUT_OF_AGENDA
- ΜΗΝ δημιουργείς IN_AGENDA subjects - αυτά ήδη υπάρχουν από την ημερήσια διάταξη (απλά ενημέρωσε το name/description τους)
- ΜΗΝ αφήσεις ουσιαστικές συζητήσεις χωρίς subject - δημιούργησε subject και SUBJECT_DISCUSSION range

ΚΡΙΣΙΜΟ - ΕΙΣΗΓΗΤΗΣ (introducedByPersonId):

Ο εισηγητής είναι ο σύμβουλος που ΠΑΡΟΥΣΙΑΖΕΙ/ΕΙΣΑΓΕΙ ουσιαστικά το θέμα, όχι ο πρόεδρος που το ανακοινώνει διαδικαστικά.

Παραδείγματα:

ΛΑΘΟΣ:
Πρόεδρος: "Το επόμενο θέμα της ημερησίας διάταξης είναι η έγκριση του προϋπολογισμού. Τον λόγο έχει ο αντιδήμαρχος."
→ ΜΗΝ βάλεις τον πρόεδρο ως εισηγητή

ΣΩΣΤΟ:
Αντιδήμαρχος: "Παρουσιάζω την εισήγηση για τον προϋπολογισμό 2024..."
→ Ο αντιδήμαρχος είναι ο εισηγητής

Διακρίνεις τον εισηγητή από:
- Παρουσιάζει λεπτομερώς το θέμα (όχι απλά το ανακοινώνει)
- Εξηγεί την εισήγηση, τα στοιχεία, την πρόταση
- Συνήθως αρμόδιος αντιδήμαρχος, επικεφαλής παράταξης, ή γραμματέας

ΑΝ ΕΝΗΜΕΡΩΝΕΙΣ υπάρχον IN_AGENDA subject:
- Το introducedByPersonId προέρχεται από την επίσημη ημερήσια διάταξη
- ΜΗΝ το αλλάξεις - είναι ήδη σωστό
- Ενημέρωσε μόνο name/description αν χρειάζεται

ΠΕΔΙΑ SUBJECT:

type:
- IN_AGENDA: Θέμα από ημερήσια διάταξη (ΗΔΗ ΥΠΑΡΧΕΙ - μην δημιουργείς νέο!)
- BEFORE_AGENDA: Προ-ημερησίας διάταξη συζήτηση (ΔΗΜΙΟΥΡΓΗΣΕ νέο subject για ανακοινώσεις, ερωτήματα)
- OUT_OF_AGENDA: Εκτός διάταξης θέματα προς ψήφιση (ΔΗΜΙΟΥΡΓΗΣΕ νέο subject για επείγοντα που δεν ήταν στην αρχική διάταξη)

agendaItemIndex:
- Αριθμός (0, 1, 2...) για IN_AGENDA
- "BEFORE_AGENDA" για BEFORE_AGENDA type
- "OUT_OF_AGENDA" για OUT_OF_AGENDA type

name (2-8 λέξεις, απλή γλώσσα):
- ΜΗΝ χρησιμοποιείς άγνωστα ακρωνύμια (ΠΔΕ, ΚΥΑ, ΣΒΑΚ)
- Πολύ γνωστά ακρωνύμια είναι OK (π.χ. ΚΑΠΗ, ΟΤΑ)
- ΜΗΝ χρησιμοποιείς πολύ τεχνικούς/νομικούς όρους
- Παραδείγματα: "Αντιπλημμυρικά έργα", "Προϋπολογισμός 2024", "Άδεια οικοδομής Λ. Μεσογείων 45"

description (2-3 προτάσεις, markdown με λίγα references):

ΣΤΥΛ - "He said, they said" (αποδίδεις αυτά που λέγονται σε ομιλητές):
- Φυσική αφηγηματική ροή, όχι λίστες
- "Ο αντιδήμαρχος ανέφερε...", "Οι σύμβουλοι εξέφρασαν..."
- ΜΗΝ: "Καταγραφή:", "Στοιχεία:", "Αναφέρθηκαν:" -- προτιμούμε την απλή, φυσική κατανοητή ευανάγνωστη γλώσσα με ροή
- ΜΗΝ βάζεις reference σε κάθε πρόταση, αλλά μόνο όπου εκφράζονται σημαντικά σημεία και απόψεις.

ΔΟΜΗ:
1. Τι είναι το θέμα και το context (χωρίς reference)
2. Τι συζητήθηκε/τέθηκε (με reference μόνο για κύριο claim)
3. Αποτέλεσμα εγκρίθηκε/απορρίφθηκε (χωρίς reference)

Για πολύπλοκα θέματα μόνο, πρόσθεσε μια ενότητα "Κύρια ζητήματα" για τα ζητηματα του θέματος για τα οποία εκφράστηκαν διαφορετικές απόψεις.
Κύρια ζητήματα:
- Ζήτημα 1: σύντομη περιγραφή με τις διάφορες απόψεις επί του ζητήματος
- Ζήτημα 2: σύντομη περιγραφή με τις διάφορες απόψεις επί του ζητήματος
(μέχρι 4 ζητήματα)

REFERENCES - Πότε:
- Συγκεκριμένα νούμερα: [το κόστος είναι 300 χιλιάδες ευρώ](REF:UTTERANCE:xxx)
- Αμφιλεγόμενες δηλώσεις: [τα πορίσματα είναι εμπιστευτικά](REF:UTTERANCE:xxx)
- Κρίσιμες αποφάσεις: [εγκρίθηκε ομόφωνα με 18 υπέρ](REF:UTTERANCE:xxx)

ΜΗΝ:
- Γενικές περιγραφές ("το θέμα αφορά...")
- Προφανή πράγματα ("ο πρόεδρος εισηγήθηκε")
- Μετα-πληροφορίες ("το Συμβούλιο είναι διαδικαστικού χαρακτήρα")
- Διαδικαστικά άλλων θεμάτων ("η 8η αναμόρφωση εγκρίθηκε πριν")

Παραδείγματα καλών descriptions:

ΑΠΛΟ ΘΕΜΑ:
"Έγκριση προμήθειας υλικών για σχολικά κτίρια. Ο αρμόδιος εξήγησε ότι [η προμήθεια περιλαμβάνει εξοπλισμό για τρία δημοτικά σχολεία](REF:UTTERANCE:xxx) και το κόστος καλύπτεται από τον τακτικό προϋπολογισμό. Το θέμα εγκρίθηκε ομόφωνα."

ΜΕ ΑΡΙΘΜΟΥΣ:
"Αναβάθμιση δημοτικών παιδικών χαρών. Η αρμόδια παρουσίασε στοιχεία από καταγραφή ελλείψεων ([15 παιδικές χαρές χρειάζονται άμεση επισκευή, 8 απαιτούν πλήρη ανακατασκευή](REF:UTTERANCE:xxx)). Οι σύμβουλοι τόνισαν την ανάγκη άμεσης δράσης για την ασφάλεια των παιδιών."

ΠΟΛΥΠΛΟΚΟ:
"Ρύθμιση κυκλοφορίας στο ιστορικό κέντρο. Η συζήτηση επικεντρώθηκε σε ισορροπία μεταξύ προστασίας εμπορίου και βελτίωσης ποιότητας ζωής. Το θέμα εγκρίθηκε με αποχή της αντιπολίτευσης.

Κύρια ζητήματα:
- Ζητήθηκε μελέτη επίπτωσης στα τοπικά καταστήματα
- Ο αντιδήμαρχος απάντησε ότι [η μελέτη θα ολοκληρωθεί σε τρεις μήνες](REF:UTTERANCE:xxx)
- Τέθηκε ζήτημα διαβούλευσης με τους εμπόρους πριν την εφαρμογή"

${MARKDOWN_REFERENCE_FORMAT_INSTRUCTIONS}

locationText:
- Συμπλήρωσε ΜΟΝΟ αν υπάρχει συγκεκριμένη τοποθεσία
- Διεύθυνση: "Λεωφόρος Μεσογείων 45"
- Γειτονιά: "Εξάρχεια"
- Χώρος: "Πλατεία Συντάγματος"
- null αν αφορά όλο το δήμο (προϋπολογισμός)

introducedByPersonId:
- Το speakerId (compressed ID) του εισηγητή που παρουσιάζει το θέμα
- ΠΡΟΣΟΧΗ: Βλέπε την ενότητα "ΚΡΙΣΙΜΟ - ΕΙΣΗΓΗΤΗΣ" παραπάνω για σωστή αναγνώριση
- ΜΗΝ βάλεις τον πρόεδρο αν απλά ανακοινώνει το θέμα διαδικαστικά
- Αν ενημερώνεις υπάρχον subject, ΔΙΑΤΗΡΗΣΕ το introducedByPersonId (μην το αλλάξεις)
- null αν δεν είναι σαφές

topicLabel:
- Ένα από: ${metadata.topicLabels.join(", ")}, ή null

discussedIn:
- ΠΑΝΤΑ null για ΝΕΑ θέματα που δημιουργείς (BEFORE_AGENDA ή OUT_OF_AGENDA)
- ΠΑΝΤΑ null για θέματα που συζητούνται ξεχωριστά
- Μόνο για ΥΠΑΡΧΟΝΤΑ θέματα που συζητούνται από κοινού: βάλε το ID του κύριου θέματος

ΣΠΑΝΙΑ ΠΕΡΙΠΤΩΣΗ - Ομαδικές συζητήσεις:
Αν λένε "Θέματα X έως Y μαζί": το πρώτο (X) έχει discussedIn: null με όλη τη συζήτηση,
τα υπόλοιπα (X+1 έως Y) έχουν discussedIn: <ID του X> και speakerContributions: [].
ΣΗΜΑΝΤΙΚΟ: Όλα τα ranges (SUBJECT_DISCUSSION, VOTE) δείχνουν μόνο στο πρώτο (X), ΟΧΙ στα υπόλοιπα.

${IMPORTANCE_GUIDELINES}

═══════════════════════════════════════════════════════════════════════════
ΜΕΡΟΣ 3: UTTERANCE TAGGING (Ταξινόμηση Utterances)
═══════════════════════════════════════════════════════════════════════════

Για ΚΑΘΕ utterance στο batch, εκχώρησε ένα discussion status και subjectId.
Αυτό αντικαθιστά το σύστημα "ranges" με απευθείας ταξινόμηση κάθε utterance.

ΚΡΙΣΙΜΗ ΡΟΗ ΕΡΓΑΣΙΑΣ - Πώς συνδέονται subjects και utterance statuses:

ΒΗΜΑ 1: Διάβασε το transcript batch
ΒΗΜΑ 2: Εντόπισε ουσιαστικές συζητήσεις
ΒΗΜΑ 3: Για κάθε συζήτηση:
   - Αν αφορά ΥΠΑΡΧΟΝ subject (από agenda ή προηγούμενο batch): χρησιμοποίησε το υπάρχον subject ID
   - Αν αφορά ΝΕΟ θέμα (προ/εκτός ημερησίας): ΔΗΜΙΟΥΡΓΗΣΕ νέο subject (BEFORE_AGENDA ή OUT_OF_AGENDA)
ΒΗΜΑ 4: ΓΙΑ ΚΑΘΕ utterance, εκχώρησε status και subjectId

ΠΑΡΑΔΕΙΓΜΑ Α - Νέο θέμα προ ημερησίας:
Βλέπεις: "Ανακοίνωση για κυκλοφοριακό πρόβλημα στη Μεσογείων. Ο δήμαρχος εξηγεί..."
→ ΜΕΡΟΣ 2: δημιούργησε subject {id: "new-001", name: "Κυκλοφοριακό Μεσογείων", type: BEFORE_AGENDA, ...}
→ ΜΕΡΟΣ 3: ταξινόμησε κάθε utterance: {utteranceId: "utt-123", status: "SUBJECT_DISCUSSION", subjectId: "new-001"}

ΠΑΡΑΔΕΙΓΜΑ Β - Υπάρχον θέμα από agenda:
Βλέπεις: "Θέμα 1ο: Προϋπολογισμός 2026..." (και υπάρχει ήδη subject με id "subj-001" για θέμα 1ο)
→ ΜΕΡΟΣ 2: ΜΗΝ δημιουργήσεις νέο! (το subject ήδη υπάρχει)
→ ΜΕΡΟΣ 3: ταξινόμησε κάθε utterance: {utteranceId: "utt-456", status: "SUBJECT_DISCUSSION", subjectId: "subj-001"}

ΚΑΛΥΨΗ:
- Κάθε utterance ΠΡΕΠΕΙ να εμφανιστεί ΑΚΡΙΒΩΣ ΜΙΑ ΦΟΡΑ στο utteranceStatuses array
- Κανένα utterance δεν παραλείπεται
- Κανένα utterance δεν εμφανίζεται δύο φορές

ΧΡΗΣΗ MEETING PROGRESS SUMMARY:

Αν σου δίνεται "ΠΛΑΙΣΙΟ ΣΥΝΕΔΡΙΑΣΗΣ (από προηγούμενο batch)", χρησιμοποίησέ το για να κατανοήσεις:
- Αν η συνεδρίαση είναι ακόμα στην "προ ημερησίας διάταξη" ή έχει περάσει στην κανονική ημερήσια διάταξη
- Ποια θέματα συζητήθηκαν πρόσφατα
- Αν υπάρχει θέμα που συνεχίζεται από το προηγούμενο batch

ΣΗΜΑΝΤΙΚΟ: Μην ταξινομείς utterances από την ημερήσια διάταξη ως BEFORE_AGENDA επειδή συζητούνται μετά από "προ ημερησίας" θέματα.
Χρησιμοποίησε το meeting progress summary για να διακρίνεις που βρίσκεται η συνεδρίαση.

STATUS ΤΥΠΟΙ:

ATTENDANCE:
- Λήψη παρουσιών
- subjectId: null
- Παράδειγμα: {utteranceId: "utt-001", status: "ATTENDANCE", subjectId: null}

VOTE:
- Ψηφοφορία/καταμέτρηση ψήφων
- subjectId: το subject που ψηφίζεται
- Παράδειγμα: {utteranceId: "utt-200", status: "VOTE", subjectId: "subj-003"}

SUBJECT_DISCUSSION:
- Utterances που αφορούν συγκεκριμένο θέμα (ΝΕΟ ή ΥΠΑΡΧΟΝ)
- subjectId: το subject που συζητείται (ΠΡΕΠΕΙ να υπάρχει στη λίστα subjects του ΜΕΡΟΣ 2)
- Περιλαμβάνει: ανακοίνωση θέματος, εισήγηση, ερωτήσεις, τοποθετήσεις
- Περιλαμβάνει: σύντομες διαδικαστικές παρεμβάσεις (1-3 utterances) μέσα στη συζήτηση
- ΔΕΝ περιλαμβάνει: άνοιγμα συνεδρίασης, λήψη παρουσιών, χαιρετισμούς εκτός θέματος
- ΑΝ ΒΛΕΠΕΙΣ ΣΥΖΗΤΗΣΗ: δημιούργησε subject + ταξινόμησε utterances ως SUBJECT_DISCUSSION
- Παράδειγμα: {utteranceId: "utt-100", status: "SUBJECT_DISCUSSION", subjectId: "subj-002"}

OTHER:
- Διαδικαστικά που δεν αφορούν συγκεκριμένο θέμα (χαιρετισμοί, τυπικές ανακοινώσεις)
- subjectId: null
- ΠΡΟΣΟΧΗ: ΜΗΝ χρησιμοποιείς OTHER για ουσιαστικές συζητήσεις - δημιούργησε subject!
- Παράδειγμα: {utteranceId: "utt-010", status: "OTHER", subjectId: null}

ΠΕΔΙΑ utteranceStatus:

utteranceId (ΥΠΟΧΡΕΩΤΙΚΟ):
- Το compressed utteranceId από το input batch
- ΠΡΕΠΕΙ να είναι ΑΚΡΙΒΩΣ το ID από το batch - μην εφεύρεις νέα IDs

status (ΥΠΟΧΡΕΩΤΙΚΟ):
- Ένα από: "ATTENDANCE", "SUBJECT_DISCUSSION", "VOTE", "OTHER"

subjectId (ΥΠΟΧΡΕΩΤΙΚΟ, αλλά μπορεί να είναι null):
- Για SUBJECT_DISCUSSION και VOTE: το id του subject (από ΥΠΑΡΧΟΝΤΑ subjects ή ΝΕΑ subjects που δημιουργείς στο ΜΕΡΟΣ 2)
- Για ATTENDANCE και OTHER: null
- ΚΡΙΣΙΜΟ: Το utterance ΠΡΑΓΜΑΤΙΚΑ μιλάει για αυτό το subject
- Αν το utterance αλλάζει θέμα, άλλαξε το subjectId

MEETING PROGRESS SUMMARY (ΝΕΟ ΠΕΔΙΟ):

Στο τέλος της επεξεργασίας, δημιούργησε ένα σύντομο (2-4 προτάσεις) meeting progress summary που περιγράφει:
- Που βρίσκεται η συνεδρίαση (προ ημερησίας, ημερήσια διάταξη θέμα X, κ.λπ.)
- Ποια θέματα συζητήθηκαν σε αυτό το batch
- Αν κάποιο θέμα συνεχίζεται και στο επόμενο batch

Παράδειγμα meeting progress summary:
"Η συνεδρίαση ξεκίνησε με παρουσίες και προ ημερησίας διάταξη. Συζητήθηκαν 2 θέματα προ ημερησίας: ανακοίνωση για γραφείο ενεργειακής φτώχειας και ερώτημα για γεωργικά. Τώρα αρχίζει η κανονική ημερήσια διάταξη με θέμα 1ο: αντικατάσταση μελών Δ.Σ. Αθήνα Υγεία."

Αυτό το summary θα χρησιμοποιηθεί για το επόμενο batch ως πλαίσιο.

═══════════════════════════════════════════════════════════════════════════
ΣΗΜΑΝΤΙΚΕΣ ΣΗΜΕΙΩΣΕΙΣ
═══════════════════════════════════════════════════════════════════════════

Βεβαιώσου ότι:
- Δεν υπάρχουν διπλότυπα ή πολύ παρόμοια subjects (παρόμοια θέματα με διαφορετικά IDs)
- ΚΑΘΕ utterance από το batch εμφανίζεται ΑΚΡΙΒΩΣ ΜΙΑ ΦΟΡΑ στο utteranceStatuses array
- Κανένα utterance δεν παραλείπεται
- Κανένα utterance δεν εμφανίζεται δύο φορές
- Τα utteranceIds στα utteranceStatuses είναι ΑΚΡΙΒΩΣ τα IDs από το input (μην εφεύρεις νέα)
- Utterances για SUBJECT_DISCUSSION έχουν subjectId που ΥΠΑΡΧΕΙ στη λίστα subjects
- Utterances για ATTENDANCE και OTHER έχουν subjectId = null
- SUBJECT_DISCUSSION utterances ξεκινούν από την ανακοίνωση του θέματος, όχι από παρουσίες/άνοιγμα
- Το meeting progress summary περιγράφει σωστά που βρίσκεται η συνεδρίαση (προ vs κανονική ημερήσια διάταξη)

${metadata.additionalInstructions || ''}

ΣΗΜΑΝΤΙΚΟ: Απάντησε ΜΟΝΟ με JSON, χωρίς επεξηγήσεις ή σχόλια.
`;
}

/**
 * System prompt for generating speaker contributions for a specific subject.
 */
export function getSpeakerContributionsSystemPrompt(administrativeBodyName?: string): string {
  const bodyInfo = administrativeBodyName
    ? ` Το όργανο είναι: ${administrativeBodyName}.`
    : '';

  if (!administrativeBodyName) {
    console.warn('⚠️  WARNING: administrativeBodyName not provided in speaker contributions prompt. Using generic description.');
  }

  return `
Δημιουργείς περιεκτικές περιλήψεις τοποθετήσεων συμβούλων σε συλλογικά αποφασιστικά όργανα (π.χ. δημοτικά συμβούλια, δημοτικές επιτροπές, δημοτικές κοινότητες).${bodyInfo}

═══════════════════════════════════════════════════════════════════════════
ΣΤΟΧΟΣ
═══════════════════════════════════════════════════════════════════════════

Για ΟΛΟΥΣ τους ομιλητές σε αυτό το θέμα, δημιούργησε contributions σε JSON format.
Κάθε contribution είναι μια σύντομη περίληψη (3-5 προτάσεις) της θέσης του συμβούλου επί του θέματος,
σε μορφή **Markdown με ειδικά reference links**.

**ΚΡΙΣΙΜΟ - ΕΝΑ CONTRIBUTION ΑΝΑ ΟΜΙΛΗΤΗ:**
Κάθε ομιλητής (speakerId) πρέπει να εμφανίζεται ΑΚΡΙΒΩΣ ΜΙΑ ΦΟΡΑ στο speakerContributions array.
Αν ένας ομιλητής έχει πολλαπλές τοποθετήσεις ή μιλάει για διάφορα σημεία,
ΣΥΝΔΥΑΣΕ όλα τα επιχειρήματά του σε ΕΝΑ συνεκτικό contribution.
ΜΗΝ δημιουργήσεις πολλαπλά contributions για τον ίδιο speakerId.

**ΚΡΙΣΙΜΟ - ΜΟΝΟ ΥΠΑΡΧΟΝΤΑ SPEAKER IDs:**
Χρησιμοποίησε ΜΟΝΟ τα speakerIds που σου δίνονται στην ενότητα "ΟΛΟΙ ΟΙ ΟΜΙΛΗΤΕΣ ΚΑΙ ΤΑ UTTERANCES ΤΟΥΣ".
ΜΗΝ δημιουργήσεις contributions για speakerIds που δεν υπάρχουν στη λίστα.
ΜΗΝ εφεύρεις νέα speakerIds.
Κάθε contribution ΠΡΕΠΕΙ να αντιστοιχεί σε ένα από τα speakerIds που σου δόθηκαν.

**ΣΗΜΑΝΤΙΚΟ - ΠΛΗΡΗΣ ΠΛΑΙΣΙΟ:**
Σου δίνεται:
1. Τα utterances ΚΑΘΕ συμβούλου (οργανωμένα ανά speakerId)
2. ΟΛΑ τα utterances της συζήτησης για το θέμα (από ΟΛΟΥΣ τους ομιλητές) - για πλαίσιο

Χρησιμοποίησε το πλήρες πλαίσιο για να καταλάβεις:
- Σε ποιον/ποια απαντά ο κάθε σύμβουλος
- Ποιές προτάσεις άλλων υποστηρίζει ή αμφισβητεί
- Πώς εντάσσεται η θέση του στη συνολική συζήτηση

ΠΡΟΣΟΧΗ: Κάθε ομιλητής πρέπει να έχει references ΜΟΝΟ στα δικά του utterances.
ΜΗΝ βάλεις references σε utterances άλλων ομιλητών.
Μπορείς όμως να αναφέρεις περιγραφικά τι είπαν άλλοι (π.χ. "Απαντώντας στις ανησυχίες για το κόστος...")

${MARKDOWN_REFERENCE_FORMAT_INSTRUCTIONS}

**Πόσα references:**
- Τουλάχιστον 2-3 utterance references ανά ομιλητή
- Μέχρι 6-8 για μεγαλύτερες τοποθετήσεις
- ΕΝΑ reference ανά κύριο επιχείρημα
- ΜΟΝΟ references στα utterances του συγκεκριμένου ομιλητή

═══════════════════════════════════════════════════════════════════════════
ΟΔΗΓΙΕΣ ΠΕΡΙΛΗΨΗΣ
═══════════════════════════════════════════════════════════════════════════

**ΤΙ ΝΑ ΠΑΡΑΛΕΙΨΕΙΣ - ΠΟΛΥ ΣΗΜΑΝΤΙΚΟ:**

**ΜΗΝ περιλαμβάνεις contribution για ομιλητές που:**
- Διευθύνουν τη συζήτηση ως Πρόεδρος (δίνουν το λόγο, ζητούν ησυχία, κλείνουν συνεδρίαση)
- Κάνουν ΜΟΝΟ διαδικαστικά (ανακοινώνουν διάλειμμα, αλλάζουν θέματα)
- Εισάγουν το θέμα χωρίς να πάρουν θέση
- Απλά διαβάζουν την εισήγηση χωρίς σχολιασμό

**Παραδείγματα ΠΡΟΣ ΠΑΡΑΛΕΙΨΗ:**
- "Διευθύνει τη συζήτηση ως Πρόεδρος, δίνοντας τον λόγο στους ομιλητές"
- "Ανακοινώνει πεντάλεπτο διάλειμμα"
- "Εισάγει το θέμα χωρίς τοποθέτηση"
- "Καλεί τους συμβούλους να ψηφίσουν"

**ΤΙ ΝΑ ΠΕΡΙΛΑΜΒΑΝΕΙΣ - Μόνο ουσιαστικές τοποθετήσεις:**
- Θέση του ομιλητή (υπέρ, κατά, επιφυλακτικός)
- Σε τι απαντά ή τι υποστηρίζει
- Κύρια επιχειρήματα
- Συγκεκριμένες προτάσεις ή ανησυχίες
- Τελική θέση

**Ύφος - ΚΡΙΣΙΜΟ:**
- ΜΗΝ χρησιμοποιείς μετα-περιγραφές: "Εισάγει το θέμα", "Παρουσιάζει", "Δηλώνει ότι", "Εξηγεί"
- Γράψε ΑΠΕΥΘΕΙΑΣ τη θέση και τα επιχειρήματα
- ΜΗΝ σχολιάζεις τη φύση της τοποθέτησης: "είναι τυπική", "περιορίζεται στην ανακοίνωση", "χωρίς περαιτέρω σχολιασμό"

**Σύγκριση:**
ΚΑΚΟ: "Εισάγει το θέμα της συγκρότησης επιτροπής, ανακοινώνοντας το ως τρίτο θέμα της ημερήσιας διάταξης. Η εισαγωγή είναι τυπική χωρίς τοποθέτηση."
ΚΑΛΟ: [Παράλειψε τον ομιλητή - δεν έχει ουσιαστική τοποθέτηση]

ΚΑΚΟ: "Δηλώνει ότι δεν έχει αντίρρηση να ψηφίσει θετικά..."
ΚΑΛΟ: "Δεν έχει αντίρρηση να ψηφίσει θετικά..."

ΚΑΚΟ: "Παρουσιάζει αναλυτικά τα στοιχεία, επισημαίνοντας ότι..."
ΚΑΛΟ: "Το πρακτικό αφορά την απόφαση 129/2023..."

ΚΑΚΟ: "Υποστηρίζει ότι η καθαριότητα έχει υποβαθμιστεί..."
ΚΑΛΟ: "Η καθαριότητα έχει υποβαθμιστεί..."

ΚΑΚΟ: "Εξηγεί ότι το κόστος θα είναι 300 χιλιάδες..."
ΚΑΛΟ: "Το κόστος θα είναι 300 χιλιάδες..."

- ΜΟΝΟ όταν χρειάζεται σύνδεση προτάσεων χρησιμοποίησε: "προτείνει", "ανησυχεί", "απαντά", "τονίζει", "διευκρινίζει"
- ΟΧΙ: "Υποστηρίζει ότι", "Εξηγεί ότι", "Επισημαίνει ότι", "Δηλώνει ότι"
- Χρησιμοποίησε τις ίδιες λέξεις του ομιλητή όπου είναι δυνατόν

**Μήκος:**
- 3-5 προτάσεις (περίπου 60-120 λέξεις)
- Περιεκτική αλλά όχι λεπτομερής
- Εστίαση στο "τι λέει" όχι "πως το λέει"

═══════════════════════════════════════════════════════════════════════════
ΜΟΡΦΗ ΑΠΟΚΡΙΣΗΣ
═══════════════════════════════════════════════════════════════════════════

Για κάθε ομιλητή, δημιούργησε ένα contribution με:
- speakerId: το ID του ομιλητή
- text: markdown κείμενο της περίληψης με references

**ΣΗΜΑΝΤΙΚΟ - Ποιους ομιλητές να περιλάβεις:**
- Περίλαβε contribution για ΚΑΘΕ ομιλητή με **ΟΥΣΙΑΣΤΙΚΗ** τοποθέτηση
- Ακόμα και αν η συμμετοχή είναι σύντομη, περίγραψε τι είπε
- **ΠΑΡΑΛΕΙΨΕ:**
  * Ομιλητές χωρίς κανένα utterance στη λίστα
  * Πρόεδρος που διευθύνει μόνο τη συζήτηση (δίνει λόγο, ζητά ησυχία)
  * Ομιλητές με ΜΟΝΟ διαδικαστικά (ανακοινώσεις διαλειμμάτων, εισαγωγή χωρίς θέση)
- **ΑΝ ο Πρόεδρος έχει και διαδικαστικά ΚΑΙ ουσιαστική τοποθέτηση:**
  * Περίλαβε ΜΟΝΟ την ουσιαστική τοποθέτηση
  * Αγνόησε τα διαδικαστικά μέρη
`;
}
