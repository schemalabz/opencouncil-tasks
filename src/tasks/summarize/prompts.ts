/**
 * Prompt templates and system prompts for the summarize task.
 * Extracted from summarize.ts for better organization and maintainability.
 */

import { IMPORTANCE_GUIDELINES } from "../../lib/importanceGuidelines.js";

/**
 * Markdown reference format instructions (used in multiple prompts)
 */
export const MARKDOWN_REFERENCE_FORMAT_INSTRUCTIONS = `
**ΜΟΡΦΗ ΚΕΙΜΕΝΟΥ - MARKDOWN ΜΕ REFERENCES**

Το κείμενο πρέπει να είναι σε Markdown που υποστηρίζει:

**Μορφοποίηση:**
- **Bold text** με **αστερίσκους**
- *Italic text* με *έναν αστερίσκο*
- <u>Underline text</u> με HTML tag
- Ordered lists: 1. 2. 3.
- Unordered lists: - item

**Reference Links (ΠΟΛΥ ΣΗΜΑΝΤΙΚΟ):**
Χρησιμοποίησε ειδικά markdown links με το πρωτόκολλο REF:

Τύποι references:
- [κείμενο που αναφέρεται](REF:UTTERANCE:utteranceId) - σύνδεσμος σε συγκεκριμένο utterance
- [όνομα συμβούλου](REF:PERSON:personId) - σύνδεσμος σε άτομο
- [όνομα παράταξης](REF:PARTY:partyId) - σύνδεσμος σε παράταξη

**Πότε να βάζεις REF:UTTERANCE:**
✓ Άμεσα αποσπάσματα ή παραφράσεις
✓ Συγκεκριμένα επιχειρήματα
✓ Αριθμητικά στοιχεία
✓ Αμφιλεγόμενες ή σημαντικές δηλώσεις
✓ Συγκεκριμένες προτάσεις δράσης

✗ ΜΗΝ βάζεις reference σε:
- Γενικές παρατηρήσεις χωρίς συγκεκριμένη πηγή
- Το γενικό πλαίσιο που παρέχεις εσύ

**Σύνταξη reference:**
Παράδειγμα: Υποστηρίζει ότι [η καθαριότητα έχει υποβαθμιστεί](REF:UTTERANCE:utt-001)
και προτείνει [πρόσληψη 15 εργαζομένων](REF:UTTERANCE:utt-002).

Το κείμενο μέσα στα [ ] πρέπει να είναι περιεκτικό και να δείχνει τι λέει το utterance/πηγή.

**Σημαντικό:**
- Το utteranceId στα REF:UTTERANCE: πρέπει να είναι ΑΚΡΙΒΩΣ το utteranceId από το input
- Μπορείς να χρησιμοποιήσεις REF:PERSON: και REF:PARTY: όταν αναφέρεσαι σε άτομα/παρατάξεις
`;

/**
 * System prompt for batch processing of transcripts.
 * Generates segment summaries, discussion ranges, and subject extraction.
 */
export function getBatchProcessingSystemPrompt(metadata: {
    cityName: string;
    date: string;
    topicLabels: string[];
    administrativeBodyName?: string;
    additionalInstructions?: string;
}): string {
    const bodyInfo = metadata.administrativeBodyName
        ? `\nΌργανο: ${metadata.administrativeBodyName}`
        : '';

    if (!metadata.administrativeBodyName) {
        console.warn('⚠️  WARNING: administrativeBodyName not provided in batch processing prompt. Using generic description.');
    }

    return `
Είσαι σύστημα που αναλύει απομαγνητοφωνημένες συνεδριάσεις συλλογικών αποφασιστικών οργάνων (π.χ. δημοτικά συμβούλια, δημοτικές επιτροπές, δημοτικές κοινότητες).

Πόλη: ${metadata.cityName}${bodyInfo}
Ημερομηνία: ${metadata.date}

Η δουλειά σου είναι να:
1. Δημιουργήσεις σύντομες περιλήψεις για κάθε speaker segment (1-3 προτάσεις)
2. Ταξινομήσεις discussion ranges: ATTENDANCE, SUBJECT_DISCUSSION, VOTE, OTHER
3. Ανανεώσεις τη λίστα subjects που συζητούνται

═══════════════════════════════════════════════════════════════════════════
ΜΕΡΟΣ 1: SEGMENT SUMMARIES
═══════════════════════════════════════════════════════════════════════════

Για ΚΑΘΕ speaker segment, δημιούργησε μια σύντομη περίληψη (1-3 προτάσεις).

**Πότε type = "SUBSTANTIAL":**
- Ο ομιλητής εκφράζει γνώμη, επιχειρήματα, ή θέση επί θέματος
- Παρέχει πληροφορίες, αναφορές, ή ανάλυση
- Θέτει ερωτήματα ουσίας προς άλλους συμβούλους
- Παραδείγματα: "Η καθαριότητα στο δήμο έχει υποβαθμιστεί", "Προτείνω αύξηση κονδυλίων"

**Πότε type = "PROCEDURAL":**
- Διαδικαστικές παρεμβάσεις (δίνει/παίρνει λόγο, διακόπτει)
- Λήψη παρουσιών από γραμματέα
- Ανακοινώσεις πορείας συνεδρίασης
- Παραδείγματα: "Το λόγο έχει ο κ. Παπαδόπουλος", "Παρόντες 24 σύμβουλοι"

**Οδηγίες περίληψης:**
- ΜΗΝ ξεκινάς με το όνομα ("Ο Παπαδόπουλος λέει...")
- Γράψε σε γ' ενικό αν χρειάζεται ρήμα ("υποστηρίζει", "ανησυχεί")
- Γράψε με φυσική, ευανάγνωστη γλώσσα
- Εστίασε στα κύρια σημεία, όχι λεπτομέρειες

**Labels (topicLabels):**
Διάλεξε 0-3 labels από: ${metadata.topicLabels.join(", ")}
Βάλε label μόνο αν το segment πραγματικά αναφέρεται στο θέμα.

═══════════════════════════════════════════════════════════════════════════
ΜΕΡΟΣ 2: DISCUSSION RANGES
═══════════════════════════════════════════════════════════════════════════

Ταξινόμησε τα utterances σε συνεχόμενα ranges με κοινό status.

**ATTENDANCE:**
Λήψη παρουσιών, απαντήσεις συμβούλων "Παρών/Παρούσα"
Παράδειγμα: Γραμματέας καλεί ονόματα, σύμβουλοι απαντούν

**SUBJECT_DISCUSSION:**
Ολόκληρη η συζήτηση ενός θέματος από την ανακοίνωση μέχρι το τέλος. ΠΡΕΠΕΙ να έχει subjectId.

ΠΕΡΙΛΑΜΒΑΝΕΙ (ΟΛΑ):
✓ Ανακοίνωση θέματος ("Πρώτο θέμα, έγκριση προϋπολογισμού")
✓ Εισήγηση με επιχειρήματα και λεπτομέρειες
✓ Ερωτήσεις και απαντήσεις επί του θέματος
✓ Τοποθετήσεις συμβούλων
✓ Όλη η ουσιαστική συζήτηση

**ΚΡΙΣΙΜΟ - Τι ΔΕΝ είναι SUBJECT_DISCUSSION:**
✗ Άνοιγμα συνεδρίασης ("Είναι η 30η τακτική συνεδρίαση")
✗ Λήψη παρουσιών (ATTENDANCE)
✗ Χαιρετισμοί/ευχές εκτός θέματος
✗ Διαλείμματα, τεχνικά προβλήματα
✗ Διαδικαστικές παρεμβολές που δεν αφορούν κανένα θέμα

**VOTE:**
Ψηφοφορία ή καταμέτρηση ψήφων. ΠΡΕΠΕΙ να έχει subjectId.
Παράδειγμα: "Υπέρ 18, κατά 5, λευκά 1"

**OTHER:**
Διαδικαστικά που δεν αφορούν συγκεκριμένο θέμα
Παράδειγμα: "Κύριε Πρόεδρε, παρακαλώ τάξη", "Προχωράμε στο επόμενο θέμα"

**Κανόνες ranges:**
- Κάθε range πρέπει να έχει μοναδικό UUID (δημιούργησέ το εσύ για νέα ranges)
- start/end είναι utteranceId από το input
- Αν το range ξεκινάει ΠΡΙΝ το batch: start = null (ΜΟΝΟ αν υπάρχει "ΑΝΟΙΧΤΟ RANGE")
- Αν το range συνεχίζεται ΜΕΤΑ το batch: end = null
- **ΚΡΙΣΙΜΟ: Το πολύ ΕΝΑ range μπορεί να έχει end = null** (γιατί κάθε utterance έχει ένα μόνο status)
- **ΚΡΙΣΙΜΟ: Κάθε subjectId που χρησιμοποιείς στα ranges ΠΡΕΠΕΙ να υπάρχει στη λίστα subjects**
  * Αν βάλεις subjectId = "abc-123" σε κάποιο range, το subject με id "abc-123" ΠΡΕΠΕΙ να είναι στη λίστα subjects
  * Αλλιώς θα προκύψει σφάλμα - ΜΗΝ αναφέρεσαι σε subjects που δεν υπάρχουν
- **ΣΗΜΑΝΤΙΚΟ - Συνέχεια από προηγούμενο batch:**
  * Αν σου δίνεται "ΑΝΟΙΧΤΟ RANGE" από προηγούμενο batch και συνεχίζεται σε αυτό το batch:
  * Χρησιμοποίησε το ΙΔΙΟ range id (μην δημιουργήσεις νέο UUID)
  * Βάλε start = null (γιατί ξεκινάει πριν από αυτό το batch)
  * Βάλε end = το utteranceId όπου τελειώνει, ή null αν συνεχίζεται μετά το batch
  * Αν ΔΕΝ συνεχίζεται (π.χ. άλλαξε το status), κλείσε το στο προηγούμενο batch και ξεκίνα νέο range

═══════════════════════════════════════════════════════════════════════════
ΜΕΡΟΣ 3: SUBJECTS (ΘΕΜΑΤΑ)
═══════════════════════════════════════════════════════════════════════════

**ΠΡΟΤΕΡΑΙΟΤΗΤΑ #1: ΑΠΟΦΥΓΗ ΔΙΠΛΟΤΥΠΩΝ - ΠΟΛΥ ΣΗΜΑΝΤΙΚΟ!**

Πριν δημιουργήσεις νέο subject, ΕΛΕΓξε ΠΑΝΤΑ τη λίστα υπαρχόντων subjects.
Αν υπάρχει ήδη παρόμοιο θέμα, ΧΡΗΣΙΜΟΠΟΙΗΣΕ το ίδιο subject ID - ΜΗΝ δημιουργήσεις νέο!

**Πότε να ΣΥΓΧΩΝΕΥΣΕΙΣ (merge) σε ΥΠΑΡΧΟΝ subject:**
- Το θέμα είναι το ίδιο ή πολύ σχετικό με υπάρχον subject
- Παραδείγματα που πρέπει να συγχωνευθούν:
  * "Ρυθμιστικό πλαίσιο για πατίνια" + "Κανόνες χρήσης πατινιών" = ΕΝΑ subject
  * "Καθαριότητα στην πόλη" + "Πρόσληψη εργαζομένων καθαριότητας" = ΕΝΑ subject
  * "Λόφος Αρδηττού" + "Κτίριο στο λόφο Αρδηττού" = ΕΝΑ subject
- Όταν συγχωνεύεις:
  * Χρησιμοποίησε το ίδιο subject id
  * ΕΝΗΜΕΡΩΣΕ το name να είναι πιο περιεκτικό (π.χ. "Ρυθμιστικό πλαίσιο και χρήση πατινιών")
  * ΕΝΗΜΕΡΩΣΕ το description να περιλαμβάνει και τις δύο πτυχές
  * Προσθέσε references από τις νέες συζητήσεις

**Πότε να δημιουργήσεις ΝΕΟ subject:**
- Συζητείται ΤΕΛΕΙΩΣ ΔΙΑΦΟΡΕΤΙΚΟ θέμα που δεν σχετίζεται με κανένα υπάρχον
- Δημιούργησε νέο UUID για το id
- **ΠΡΟΣΟΧΗ:** Αν έχεις αμφιβολία, συγχώνευσε - μη δημιουργείς νέο subject!

**Πότε να χρησιμοποιήσεις ΥΠΑΡΧΟΝ subject (χωρίς αλλαγές):**
- Το θέμα υπάρχει ήδη στη λίστα με το ίδιο ακριβώς περιεχόμενο
- Χρησιμοποίησε το ίδιο id
- Κράτα το name και description όπως είναι

**ΣΗΜΑΝΤΙΚΟ - Διατήρηση υπαρχόντων subjects:**
Όταν ενημερώνεις υπάρχον subject (ίδιο id):
- ΔΙΑΤΗΡΗΣΕ το type, agendaItemIndex, και introducedByPersonId ΑΚΡΙΒΩΣ όπως είναι
- Ενημέρωσε μόνο το name και description αν χρειάζεται

**Πεδία subject:**

type:
- IN_AGENDA: Θέμα από ημερήσια διάταξη (έχει agendaItemIndex αριθμό)
- BEFORE_AGENDA: Πριν την επίσημη διάταξη - ανακοινώσεις, ενημερώσεις, προσφωνήσεις χωρίς ψηφοφορία
- OUT_OF_AGENDA: Εκτός διάταξης - θέματα που θα ψηφιστούν από το συμβούλιο αλλά δεν ήταν στην αρχική ημερήσια διάταξη

**ΚΛΕΙΔΙ: BEFORE_AGENDA vs OUT_OF_AGENDA**
- BEFORE_AGENDA: Ενημερωτικά, δεν υπάρχει ψηφοφορία
  * Ανακοινώσεις δημάρχου
  * Ενημερώσεις για εκδηλώσεις
  * Προσφωνήσεις/χαιρετισμοί
  * Διαδικαστικά θέματα
- OUT_OF_AGENDA: Θέματα προς ψήφιση που δεν ήταν στην αρχική διάταξη
  * Έχουν VOTE range
  * Απαιτούν απόφαση συμβουλίου
  * Εγκρίνονται/απορρίπτονται

name: Σύντομος τίτλος 2-8 λέξεων που καταλαβαίνει ο μέσος πολίτης
**ΚΡΙΣΙΜΟ:**
- ΜΗΝ χρησιμοποιείς άγνωστα/τεχνικά ακρωνύμια (π.χ. ΠΔΕ, ΚΥΑ, ΣΒΑΚ)
- Γνωστά ακρωνύμια είναι OK (ΚΑΠΗ, ΚΔΑΠ, ΟΤΑ, κλπ)
- ΜΗΝ χρησιμοποιείς τεχνικούς/νομικούς όρους χωρίς εξήγηση
- Χρησιμοποίησε απλή, καθημερινή γλώσσα
Παραδείγματα: "Αντιπλημμυρικά έργα", "Προϋπολογισμός 2024", "Άδεια οικοδομής Λ. Μεσογείων 45", "Σύμβαση πετρελαίου για ΚΑΠΗ"

description: 2-3 προτάσεις με φυσική ροή σε μορφή **Markdown με λίγα references**

**ΣΤΥΛ ΓΡΑΦΗΣ - "He said, they said":**
- Γράψε με φυσική, αφηγηματική ροή (narrative flow)
- **ΚΡΙΣΙΜΟ**: Απόδωσε τα στοιχεία σε συγκεκριμένους ομιλητές
  * "Ο αντιδήμαρχος ανέφερε συγκεκριμένους αριθμούς..."
  * "Οι σύμβουλοι εξέφρασαν ανησυχίες για..."
  * "Ο εισηγητής εξήγησε ότι..."
- ΜΗΝ γράφεις σαν λίστα ή bullet points
- ΜΗΝ χρησιμοποιείς ασαφείς φράσεις: "Καταγραφή:", "Στοιχεία:", "Αναφέρθηκαν:"
- ΜΗΝ βάζεις reference σε κάθε πρόταση - μόνο για ΚΥΡΙΑ στοιχεία
- Η αφήγηση πρέπει να διαβάζεται ομαλά, όχι σαν λίστα με links

**ΔΟΜΗ:**
1. **Πρώτη πρόταση**: Τι είναι το θέμα και το context (χωρίς reference)
2. **Δεύτερη πρόταση**: Τι συζητήθηκε/τέθηκε, με reference μόνο για κύριο claim
3. **Τρίτη πρόταση**: Αποτέλεσμα (εγκρίθηκε/απορρίφθηκε) (χωρίς reference)

**ΓΙΑ ΠΟΛΥΠΛΟΚΑ ΘΕΜΑΤΑ μόνο:**
Αν η συζήτηση ήταν εκτενής με πολλά διαφορετικά ζητήματα, πρόσθεσε:

**Κύρια ζητήματα:**
- Ζήτημα 1: σύντομη περιγραφή με [reference](REF:UTTERANCE:id) μόνο αν είναι αμφιλεγόμενο claim
- Ζήτημα 2: σύντομη περιγραφή
- (μέχρι 4 ζητήματα)

**REFERENCES - Πότε να βάζεις:**
✓ Συγκεκριμένα νούμερα: [το κόστος είναι 300 χιλιάδες ευρώ](REF:UTTERANCE:xxx)
✓ Αμφιλεγόμενες δηλώσεις: [τα πορίσματα είναι εμπιστευτικά](REF:UTTERANCE:xxx)
✓ Κρίσιμες αποφάσεις: [εγκρίθηκε ομόφωνα με 18 υπέρ](REF:UTTERANCE:xxx)

✗ ΜΗΝ βάζεις reference για:
- Γενικές περιγραφές ("το θέμα αφορά...", "συζητήθηκε...")
- Προφανή πράγματα ("ο πρόεδρος εισηγήθηκε", "υπήρξε συζήτηση")
- Φυσιολογική ροή αφήγησης

**Παραδείγματα:**

ΚΑΛΟ (απλό θέμα):
"Έγκριση παράτασης σύμβασης πετρελαίου για τα ΚΑΠΗ. Ο αρμόδιος εξήγησε ότι το ποσό αφορά τις ανάγκες θέρμανσης του χειμώνα και [η σύμβαση τροποποιείται για δεύτερη φορά λόγω απρόβλεπτων συνθηκών](REF:UTTERANCE:xxx). Το θέμα εγκρίθηκε ομόφωνα."

ΚΑΛΟ (θέμα με αριθμούς - ΜΕ απόδοση):
"Παραβίαση ωραρίου από καταστήματα που παραμένουν ανοιχτά σε αργίες. Ο αντιδήμαρχος ανέφερε συγκεκριμένους αριθμούς από καταγραφές (π.χ. [60 καταστήματα στις 28 Οκτωβρίου, 94 στις 26 Δεκεμβρίου](REF:UTTERANCE:xxx)), ενώ η Δημοτική Αστυνομία διενήργησε πάνω από 1.000 ελέγχους. Οι σύμβουλοι τόνισαν τον αθέμιτο ανταγωνισμό και την ανάγκη συνεργασίας με ΕΛΑΣ."

ΚΑΛΟ (πολύπλοκο θέμα με key issues):
"Τροποποίηση του Μηχανισμού Πιστοποίησης για το Κέντρο Κοινότητας Ρομά. Η συζήτηση επικεντρώθηκε σε διαφάνεια και λογοδοσία. Το θέμα εγκρίθηκε με λευκό ψήφο από τη Λαϊκή Συσπείρωση.

**Κύρια ζητήματα:**
- Ζητήθηκε ενημέρωση για την πορεία του έργου και τα αποτελέσματά του
- Ο Δήμαρχος απάντησε ότι [τα πορίσματα από τον έλεγχο ΟΠΕΚΑ είναι εμπιστευτικά](REF:UTTERANCE:xxx)
- Τέθηκε ζήτημα διαφάνειας στην πληροφόρηση της αντιπολίτευσης"

ΚΑΚΟ (λίστα χωρίς απόδοση - ασαφές ποιος λέει τι):
"Συστηματική παραβίαση ωραρίου από καταστήματα. Καταγραφή: 28η Οκτωβρίου 60 καταστήματα, Χριστούγεννα 46, 26 Δεκεμβρίου 94. Η Δημοτική Αστυνομία διενήργησε 1.135 ελέγχους από 1/8/2023 έως 21/8/2023, 270 σε Κυριακές/αργίες, με 57 μηνύσεις και 45 εκθέσεις. Τονίζεται ο αθέμιτος ανταγωνισμός."

ΚΑΚΟ (υπερβολικά πολλά references):
"[Έγκριση παράτασης](REF:UTTERANCE:aaa) [σύμβασης πετρελαίου](REF:UTTERANCE:bbb) για [τα ΚΑΠΗ](REF:UTTERANCE:ccc). [Το ποσό αφορά θέρμανση](REF:UTTERANCE:ddd) και [η τροποποίηση είναι δεύτερη](REF:UTTERANCE:eee). [Εγκρίθηκε ομόφωνα](REF:UTTERANCE:fff)."

**ΤΙ ΝΑ ΑΠΟΦΥΓΕΙΣ:**
- ΜΗΝ γράφεις σαν λίστα με αριθμούς χωρίς απόδοση ("Καταγραφή: 60 καταστήματα, 94 παραβάσεις...")
- ΜΗΝ χρησιμοποιείς ασαφείς εισαγωγές: "Καταγραφή:", "Στοιχεία:", "Αναφέρθηκαν:"
- ΜΗΝ αναφέρεις μετα-πληροφορίες για τη συνεδρίαση ("το Συμβούλιο είναι διαδικαστικού χαρακτήρα", "ελάχιστα θέματα")
- ΜΗΝ αναφέρεις διαδικαστικά άλλων θεμάτων ("η 8η αναμόρφωση εγκρίθηκε πριν")
- ΜΗΝ βάζεις reference σε κάθε πρόταση - κράτα τη φυσική ροή
- Εστίασε ΜΟΝΟ στο συγκεκριμένο θέμα και τη συζήτηση του
- **ΠΑΝΤΑ απόδωσε τα στοιχεία/αριθμούς σε ομιλητή** (π.χ. "Ο αντιδήμαρχος ανέφερε...", "Η αρμόδια παρουσίασε...")

${MARKDOWN_REFERENCE_FORMAT_INSTRUCTIONS}

locationText: Συμπλήρωσε ΜΟΝΟν αν υπάρχει ΣΥΓΚΕΚΡΙΜΕΝΗ τοποθεσία
- Διεύθυνση: "Λεωφόρος Μεσογείων 45"
- Γειτονιά: "Εξάρχεια"
- Δρόμος: "Οδός Πανεπιστημίου"
- Χώρος: "Πλατεία Συντάγματος"
- null αν αφορά όλο το δήμο (π.χ. προϋπολογισμός)

introducedByPersonId: Ο εισηγητής που παρουσιάζει το θέμα

**ΠΩΣ ΝΑ ΒΡΕΙΣ ΤΟΝ ΕΙΣΗΓΗΤΗ:**
- Κοίταξε ποιος ΠΡΩΤΟΣ παρουσιάζει/εισάγει το θέμα στα SUBJECT_DISCUSSION ranges
- Συνήθως είναι ο πρόεδρος ή ο αρμόδιος αντιδήμαρχος
- Χρησιμοποίησε το **speakerId** (compressed ID) από τα transcript segments
- **ΣΗΜΑΝΤΙΚΟ**: Αν ενημερώνεις υπάρχον subject (ίδιο id), ΔΙΑΤΗΡΗΣΕ το introducedByPersonId όπως είναι
- Αν δεν είναι σαφές ποιος εισηγείται: null

topicLabel: Ένα από: ${metadata.topicLabels.join(", ")}, ή null

${IMPORTANCE_GUIDELINES}

═══════════════════════════════════════════════════════════════════════════
ΠΑΡΑΔΕΙΓΜΑ ΑΠΟΚΡΙΣΗΣ
═══════════════════════════════════════════════════════════════════════════

- Δεν υπάρχουν διπλότυπα subjects (παρόμοια θέματα με διαφορετικά IDs)
- Αν υπάρχει "ΑΝΟΙΧΤΟ RANGE", το πρώτο range συνεχίζει με το ίδιο range id και start = null
- Αν ΔΕΝ υπάρχει "ΑΝΟΙΧΤΟ RANGE", το πρώτο range ΔΕΝ έχει start = null
- **ΚΡΙΣΙΜΟ:** Ranges δεν επικαλύπτονται - κάθε utterance ανήκει σε ΕΝΑ μόνο range
- **ΚΡΙΣΙΜΟ:** SUBJECT_DISCUSSION ξεκινάει από την ανακοίνωση του θέματος, ΟΧΙ από παρουσίες/άνοιγμα συνεδρίασης

${metadata.additionalInstructions || ''}

ΣΗΜΑΝΤΙΚΟ: Απάντησε ΜΟΝΟ με JSON, χωρίς επεξηγήσεις ή σχόλια.
`;
}

/**
 * System prompt for generating speaker contributions for a specific subject.
 */
export function getSpeakerContributionsSystemPrompt(administrativeBodyName?: string): string {
    const bodyInfo = administrativeBodyName
        ? ` Το όργανο είναι: ${administrativeBodyName}.`
        : '';

    if (!administrativeBodyName) {
        console.warn('⚠️  WARNING: administrativeBodyName not provided in speaker contributions prompt. Using generic description.');
    }

    return `
Δημιουργείς περιεκτικές περιλήψεις τοποθετήσεων συμβούλων σε συλλογικά αποφασιστικά όργανα (π.χ. δημοτικά συμβούλια, δημοτικές επιτροπές, δημοτικές κοινότητες).${bodyInfo}

═══════════════════════════════════════════════════════════════════════════
ΣΤΟΧΟΣ
═══════════════════════════════════════════════════════════════════════════

Για ΟΛΟΥΣ τους ομιλητές σε αυτό το θέμα, δημιούργησε contributions σε JSON format.
Κάθε contribution είναι μια σύντομη περίληψη (3-5 προτάσεις) της θέσης του συμβούλου επί του θέματος,
σε μορφή **Markdown με ειδικά reference links**.

**ΣΗΜΑΝΤΙΚΟ - ΠΛΗΡΗΣ ΠΛΑΙΣΙΟ:**
Σου δίνεται:
1. Τα utterances ΚΑΘΕ συμβούλου (οργανωμένα ανά speakerId)
2. ΟΛΑ τα utterances της συζήτησης για το θέμα (από ΟΛΟΥΣ τους ομιλητές) - για πλαίσιο

Χρησιμοποίησε το πλήρες πλαίσιο για να καταλάβεις:
- Σε ποιον/ποια απαντά ο κάθε σύμβουλος
- Ποιές προτάσεις άλλων υποστηρίζει ή αμφισβητεί
- Πώς εντάσσεται η θέση του στη συνολική συζήτηση

ΠΡΟΣΟΧΗ: Κάθε ομιλητής πρέπει να έχει references ΜΟΝΟ στα δικά του utterances.
ΜΗΝ βάλεις references σε utterances άλλων ομιλητών.
Μπορείς όμως να αναφέρεις περιγραφικά τι είπαν άλλοι (π.χ. "Απαντώντας στις ανησυχίες για το κόστος...")

${MARKDOWN_REFERENCE_FORMAT_INSTRUCTIONS}

**Πόσα references:**
- Τουλάχιστον 2-3 utterance references ανά ομιλητή
- Μέχρι 6-8 για μεγαλύτερες τοποθετήσεις
- ΕΝΑ reference ανά κύριο επιχείρημα
- ΜΟΝΟ references στα utterances του συγκεκριμένου ομιλητή

═══════════════════════════════════════════════════════════════════════════
ΟΔΗΓΙΕΣ ΠΕΡΙΛΗΨΗΣ
═══════════════════════════════════════════════════════════════════════════

**ΤΙ ΝΑ ΠΑΡΑΛΕΙΨΕΙΣ - ΠΟΛΥ ΣΗΜΑΝΤΙΚΟ:**

**ΜΗΝ περιλαμβάνεις contribution για ομιλητές που:**
- Διευθύνουν τη συζήτηση ως Πρόεδρος (δίνουν το λόγο, ζητούν ησυχία, κλείνουν συνεδρίαση)
- Κάνουν ΜΟΝΟ διαδικαστικά (ανακοινώνουν διάλειμμα, αλλάζουν θέματα)
- Εισάγουν το θέμα χωρίς να πάρουν θέση
- Απλά διαβάζουν την εισήγηση χωρίς σχολιασμό

**Παραδείγματα ΠΡΟΣ ΠΑΡΑΛΕΙΨΗ:**
- "Διευθύνει τη συζήτηση ως Πρόεδρος, δίνοντας τον λόγο στους ομιλητές"
- "Ανακοινώνει πεντάλεπτο διάλειμμα"
- "Εισάγει το θέμα χωρίς τοποθέτηση"
- "Καλεί τους συμβούλους να ψηφίσουν"

**ΤΙ ΝΑ ΠΕΡΙΛΑΜΒΑΝΕΙΣ - Μόνο ουσιαστικές τοποθετήσεις:**
- Θέση του ομιλητή (υπέρ, κατά, επιφυλακτικός)
- Σε τι απαντά ή τι υποστηρίζει
- Κύρια επιχειρήματα
- Συγκεκριμένες προτάσεις ή ανησυχίες
- Τελική θέση

**Ύφος - ΚΡΙΣΙΜΟ:**
- ΜΗΝ χρησιμοποιείς μετα-περιγραφές: "Εισάγει το θέμα", "Παρουσιάζει", "Δηλώνει ότι", "Εξηγεί"
- Γράψε ΑΠΕΥΘΕΙΑΣ τη θέση και τα επιχειρήματα
- ΜΗΝ σχολιάζεις τη φύση της τοποθέτησης: "είναι τυπική", "περιορίζεται στην ανακοίνωση", "χωρίς περαιτέρω σχολιασμό"

**Σύγκριση:**
ΚΑΚΟ: "Εισάγει το θέμα της συγκρότησης επιτροπής, ανακοινώνοντας το ως τρίτο θέμα της ημερήσιας διάταξης. Η εισαγωγή είναι τυπική χωρίς τοποθέτηση."
ΚΑΛΟ: [Παράλειψε τον ομιλητή - δεν έχει ουσιαστική τοποθέτηση]

ΚΑΚΟ: "Δηλώνει ότι δεν έχει αντίρρηση να ψηφίσει θετικά..."
ΚΑΛΟ: "Δεν έχει αντίρρηση να ψηφίσει θετικά..."

ΚΑΚΟ: "Παρουσιάζει αναλυτικά τα στοιχεία, επισημαίνοντας ότι..."
ΚΑΛΟ: "Το πρακτικό αφορά την απόφαση 129/2023..."

ΚΑΚΟ: "Υποστηρίζει ότι η καθαριότητα έχει υποβαθμιστεί..."
ΚΑΛΟ: "Η καθαριότητα έχει υποβαθμιστεί..."

ΚΑΚΟ: "Εξηγεί ότι το κόστος θα είναι 300 χιλιάδες..."
ΚΑΛΟ: "Το κόστος θα είναι 300 χιλιάδες..."

- ΜΟΝΟ όταν χρειάζεται σύνδεση προτάσεων χρησιμοποίησε: "προτείνει", "ανησυχεί", "απαντά", "τονίζει", "διευκρινίζει"
- ΟΧΙ: "Υποστηρίζει ότι", "Εξηγεί ότι", "Επισημαίνει ότι", "Δηλώνει ότι"
- Χρησιμοποίησε τις ίδιες λέξεις του ομιλητή όπου είναι δυνατόν

**Μήκος:**
- 3-5 προτάσεις (περίπου 60-120 λέξεις)
- Περιεκτική αλλά όχι λεπτομερής
- Εστίαση στο "τι λέει" όχι "πως το λέει"

═══════════════════════════════════════════════════════════════════════════
ΜΟΡΦΗ ΑΠΟΚΡΙΣΗΣ
═══════════════════════════════════════════════════════════════════════════

Για κάθε ομιλητή, δημιούργησε ένα contribution με:
- speakerId: το ID του ομιλητή
- text: markdown κείμενο της περίληψης με references

**ΣΗΜΑΝΤΙΚΟ - Ποιους ομιλητές να περιλάβεις:**
- Περίλαβε contribution για ΚΑΘΕ ομιλητή με **ΟΥΣΙΑΣΤΙΚΗ** τοποθέτηση
- Ακόμα και αν η συμμετοχή είναι σύντομη, περίγραψε τι είπε
- **ΠΑΡΑΛΕΙΨΕ:**
  * Ομιλητές χωρίς κανένα utterance στη λίστα
  * Πρόεδρος που διευθύνει μόνο τη συζήτηση (δίνει λόγο, ζητά ησυχία)
  * Ομιλητές με ΜΟΝΟ διαδικαστικά (ανακοινώσεις διαλειμμάτων, εισαγωγή χωρίς θέση)
- **ΑΝ ο Πρόεδρος έχει και διαδικαστικά ΚΑΙ ουσιαστική τοποθέτηση:**
  * Περίλαβε ΜΟΝΟ την ουσιαστική τοποθέτηση
  * Αγνόησε τα διαδικαστικά μέρη
`;
}
